{% extends "base.html" %}

{% block content %}
    
    {# ============================================================================== #}
    {# 1. ã‚«ã‚¹ã‚¿ãƒ CSSã‚»ã‚¯ã‚·ãƒ§ãƒ³ #}
    {# ============================================================================== #}
    <style>
        /* ãƒ©ãƒ™ãƒ«ã‚’ç‹¬ç«‹ã—ãŸè¡Œã«ã—ã€å¤ªå­—ã§èª­ã¿ã‚„ã™ãè¨­å®š */
        .form-label {
            display: block; 
            margin-bottom: 0.25rem;
            font-weight: 600;
        }
        
        /* ğŸ’¡ ç‰¹å®šã®ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼ˆé€²æ—ãƒ»å„ªå…ˆåº¦ï¼‰ã®æ¨ªå¹…ã‚’150pxã«å›ºå®šã€‚
           Bootstrapã®width:100%è¨­å®šã‚’!importantã§ä¸Šæ›¸ãã—ã¦ã€è¦‹ãŸç›®ã‚’æ•´ãˆã¾ã™ã€‚ */
        select[name="status"], 
        select[name="priority"] {
            width: 150px !important;
            display: inline-block !important;
        }

        /* å…¥åŠ›é …ç›®ã®è§’ã‚’å°‘ã—ä¸¸ãã—ã¦ãƒ¢ãƒ€ãƒ³ãªå°è±¡ã« */
        .form-control, .form-select {
            border-radius: 0.375rem;
        }
    </style>
    
    {# ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ï¼šç·¨é›†ã‹æ–°è¦ä½œæˆã‹ã‚’å‹•çš„ã«åˆ‡ã‚Šæ›¿ãˆ #}
    <h2 class="mb-4">ã‚¿ã‚¹ã‚¯ã®{% if form.instance.pk %}ç·¨é›†{% else %}æ–°è¦ä½œæˆ{% endif %}</h2>

    <form method="post">
        {% csrf_token %}

        {# ============================================================================== #}
        {# 2. ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆåˆ¶å¾¡ç”¨ã®éš ã—ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ #}
        {# ğŸ’¡ æ–°è¦ä½œæˆä¸­ã«ã‚«ãƒ†ã‚´ãƒªè¿½åŠ ç”»é¢ã¸ç§»å‹•ã—ã€æˆ»ã£ã¦ããŸéš›ã®URLã‚’ä¿æŒã—ã¾ã™ã€‚ #}
        {# ============================================================================== #}
        {% if not form.instance.pk %}
            {% if request.GET.next %}
                <input type="hidden" name="next" value="{{ request.GET.next }}">
            {% else %}
                <input type="hidden" name="next" value="{{ request.META.HTTP_REFERER|default:"" }}">
            {% endif %}
        {% endif %}

        {# ============================================================================== #}
        {# 3. ãƒ•ã‚©ãƒ¼ãƒ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰ #}
        {# ============================================================================== #}
        <div class="row">
            {% for field in form %}
                
                {# --- ã‚«ãƒ†ã‚´ãƒªé¸æŠ --- #}
                {% if field.name == 'category' %}
                    <div class="mb-3 col-12 col-md-8">
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        <div class="input-group">
                            {{ field }}
                            {# ã‚«ãƒ†ã‚´ãƒªä½œæˆå¾Œã€ã“ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹ãŸã‚ã« next={{ request.path }} ã‚’ä»˜ä¸ #}
                            <a href="{% url 'category_create' %}?next={{ request.path }}" class="btn btn-outline-secondary">
                                + ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ 
                            </a>
                        </div>
                        {% for error in field.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                
                {# --- é€²æ—çŠ¶æ³ (status) & å„ªå…ˆåº¦ (priority) --- #}
                {% elif field.name == 'status' or field.name == 'priority' %}
                    <div class="mb-3 col-12">
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        {{ field }}
                        {% for error in field.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>

                {# --- è©³ç´° (description) --- #}
                {% elif field.name == 'description' %}
                     <div class="mb-3 col-12 col-md-10">
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        {{ field }}
                        {% for error in field.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                
                {# --- æœŸé™ (due_date) --- #}
                {% elif field.name == 'due_date' %}
                    <div class="mb-3 col-12"> 
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        <div style="max-width: 200px;"> 
                            {{ field }}
                        </div>
                        {% for error in field.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>

                {# --- ãã®ä»–ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã©ï¼‰ --- #}
                {% else %}
                    <div class="mb-3 col-12 col-md-8">
                        <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                        {{ field }}
                        {% for error in field.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
        
        {# ============================================================================== #}
        {# 4. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆä¿å­˜ãƒ»ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼‰ #}
        {# ============================================================================== #}
        <div class="mt-4 pb-5">
            <button type="submit" class="btn btn-success me-2">ä¿å­˜ã™ã‚‹</button>
            
            {# ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã¯ View ã‹ã‚‰æ¸¡ã•ã‚ŒãŸ cancel_url ã¸ã€‚å–å¾—ã§ããªã‘ã‚Œã°ãƒ›ãƒ¼ãƒ ã¸ã€‚ #}
            <a href="{% if cancel_url %}{{ cancel_url }}{% else %}{% url 'home' %}{% endif %}" class="btn btn-secondary">
                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </a>
        </div>
    </form>

{% endblock content %}
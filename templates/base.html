<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {# ページ固有のタイトルをブロックで定義 #}
    <title>{% block title %}タスク管理アプリ{% endblock %}</title>
    
    {# Bootstrap CSSの読み込み #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* 簡単な全体設定: 固定ナビゲーションバーの高さ分、<body>の上部にパディングを設定 */
        body { padding-top: 56px; } 

        /*
        ============================================================================== 
        モバイルビュー (画面幅が992px未満) の場合のカスタムCSS 
        ナビゲーションバーのドロップダウンメニューの表示を調整し、展開時に自然な外観にする 
        ============================================================================== 
        */
        @media (max-width: 991.98px) {
            /* ドロップダウンメニューの背景色をナビゲーションバーと同じにする (透明にし、親のbg-darkを継承) */
            .navbar-collapse .dropdown-menu {
                background-color: transparent !important; 
                border: none; 
                padding: 0 0 0 1rem; /* 他のメニュー項目より少し右にずらして階層を表現 */
                position: static !important; /* 絶対配置ではなくなり、縦に並ぶようにする */
                margin-top: 0;
                margin-bottom: 0;
                box-shadow: none;
            }
            /* ドロップダウンアイテムを通常の nav-link スタイルに近づける */
            .navbar-collapse .dropdown-item {
                color: rgba(255, 255, 255, 0.55); /* nav-linkの通常色 */
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            .navbar-collapse .dropdown-item:hover {
                color: rgba(255, 255, 255, 0.75); /* nav-linkのホバー色 */
                background-color: transparent; /* 背景色のホバー効果を削除 */
            }
            /* 区切り線（hr）はモバイルでは非表示に */
            .navbar-collapse .dropdown-divider {
                display: none;
            }
            /* ログアウトボタン（form内のボタン）のスタイル調整 */
            /* button.dropdown-item に適用することで、ホバー領域を適切に調整 */
            .navbar-collapse .dropdown-item button.dropdown-item {
                padding: 0.25rem 1rem; 
            }
        }
    </style>
</head>
<body>
    {# ============================================================================== #}
    {# ナビゲーションバー: 固定配置 (fixed-top)、ダークテーマ (bg-dark) #}
    {# ============================================================================== #}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="{% url 'home' %}">タスクマネージャー</a>
            
            {# モバイルビューでメニューを切り替えるためのトグルボタン #}
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            {# ナビゲーションアイテムのコンテナ #}
            <div class="collapse navbar-collapse" id="navbarNav">
                {# ms-auto でメニューアイテムを右寄せ (margin-left: auto) にする #}
                <ul class="navbar-nav ms-auto">
                    
                    {# -------------------------------------------------------------------------------- #}
                    {# 認証済みユーザー向けのメニュー #}
                    {# -------------------------------------------------------------------------------- #}
                    {% if user.is_authenticated %}
                        <li class="nav-item"><a class="nav-link" href="{% url 'home' %}">タスク一覧</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'task_create' %}">タスク作成</a></li> 
                        <li class="nav-item"><a class="nav-link" href="{% url 'category_list' %}">カテゴリ管理</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'trash' %}">ゴミ箱</a></li>
                        
                        {# ユーザー名と設定を含むドロップダウンメニュー #}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                👤 {{ user.username }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                                
                                <li>
                                    <a class="dropdown-item" href="{% url 'profile_edit' %}">アカウント情報の編集</a>
                                </li>
                                
                                <li>
                                    <a class="dropdown-item" href="{% url 'password_change' %}">パスワードの変更</a>
                                </li>
                                
                                <li><hr class="dropdown-divider"></li>
                                
                                <li>
                                    {# ログアウトはPOSTリクエストで行う必要があるため、formタグを使用 #}
                                    <form action="{% url 'logout' %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="dropdown-item"> 
                                            ログアウト
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                        
                    {# -------------------------------------------------------------------------------- #}
                    {# 未認証ユーザー向けのメニュー #}
                    {# -------------------------------------------------------------------------------- #}
                    {% else %}
                        {# ログイン/登録ボタンを nav-link と btn クラスで装飾 #}
                        <li class="nav-item"><a class="nav-link btn btn-primary me-2" href="{% url 'login' %}">ログイン</a></li>
                        <li class="nav-item"><a class="nav-link btn btn-success" href="{% url 'register' %}">ユーザー登録</a></li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    {# メインコンテンツコンテナ #}
    <div class="container mt-4">
        {# 子テンプレートが独自のコンテンツを挿入する場所 #}
        {% block content %}
        {% endblock %}
    </div>

    {# Bootstrap JavaScriptの読み込み (トグルやドロップダウン機能用) #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>